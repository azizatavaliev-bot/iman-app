import{s as Q,j as e,N as U,R as he,X as R,P as ue,a as J,h as X,W as fe}from"./index-NuxdLuKF.js";import{b as l}from"./vendor-CpRrxz-h.js";import{Q as C,a as N}from"./data-quiz-CsAIF-_r.js";import{A as W}from"./arrow-left-BUlvncKk.js";import{R as _}from"./rotate-ccw-KVN5UBe3.js";import{Z as ge}from"./zap-BJX1j4r8.js";import{C as pe}from"./chevron-up-asjyHnWq.js";const B="iman_quiz_scores",F="iman_quiz_history";function be(n){const r=[...n];for(let o=r.length-1;o>0;o--){const x=Math.floor(Math.random()*(o+1));[r[o],r[x]]=[r[x],r[o]]}return r}function Z(){try{const n=localStorage.getItem(B);if(n)return JSON.parse(n)}catch{}return{}}function je(n){localStorage.setItem(B,JSON.stringify(n)),X()}function Y(){try{const n=localStorage.getItem(F);if(n)return JSON.parse(n)}catch{}return[]}function Ne(n){const r=Y();r.unshift(n),r.length>50&&(r.length=50),localStorage.setItem(F,JSON.stringify(r)),X()}function we(n){const r={emerald:{border:"border-emerald-500/50",bg:"bg-emerald-500/10",text:"text-emerald-400",glow:"shadow-emerald-500/20"},amber:{border:"border-amber-500/50",bg:"bg-amber-500/10",text:"text-amber-400",glow:"shadow-amber-500/20"},sky:{border:"border-sky-500/50",bg:"bg-sky-500/10",text:"text-sky-400",glow:"shadow-sky-500/20"},purple:{border:"border-purple-500/50",bg:"bg-purple-500/10",text:"text-purple-400",glow:"shadow-purple-500/20"},rose:{border:"border-rose-500/50",bg:"bg-rose-500/10",text:"text-rose-400",glow:"shadow-rose-500/20"},teal:{border:"border-teal-500/50",bg:"bg-teal-500/10",text:"text-teal-400",glow:"shadow-teal-500/20"},violet:{border:"border-violet-500/50",bg:"bg-violet-500/10",text:"text-violet-400",glow:"shadow-violet-500/20"}};return r[n]||r.emerald}function Ie(){const[n,r]=l.useState("home"),[o,x]=l.useState(Z),[d,G]=l.useState(null),[m,K]=l.useState([]),[g,O]=l.useState(0),[b,z]=l.useState(null),[j,T]=l.useState(0),[y,M]=l.useState([]),[V,E]=l.useState(!1),[v,ee]=l.useState(!0),[D,H]=l.useState(0),[te,k]=l.useState(!1),[se,S]=l.useState(!1),ae=l.useMemo(()=>{const t={};return C.forEach(s=>{t[s.category]=(t[s.category]||0)+1}),t},[]),q=l.useCallback(t=>{G(t),O(0),z(null),T(0),M([]),E(!1),k(!1),S(!1),H(0);const s=t||"_all";ee(!Q.isQuizScored(s));const a=t?C.filter(c=>c.category===t):[...C],i=be(a);K(i),r("playing")},[]),re=l.useCallback(t=>{if(b!==null)return;const s=m[g],a=t===s.correctIndex;z(t),E(!0),a?(T(i=>i+1),S(!0),setTimeout(()=>S(!1),600)):(k(!0),navigator.vibrate?.(100),setTimeout(()=>k(!1),500),M(i=>[...i,{question:s,selectedIndex:t}]))},[b,m,g]),le=l.useCallback(()=>{if(g+1>=m.length){const s=m.length,a=j,i=s>0?Math.round(a/s*100):0,c=d||"_all",h={...Z()},p=h[c];(!p||i>p.percentage)&&(h[c]={correct:a,total:s,percentage:i},je(h),x(h));let f=0;v&&a>0&&(f=a*ue.QUIZ_CORRECT,Q.addExtraPoints(f),Q.markQuizScored(c),H(f)),Ne({date:new Date().toISOString(),category:d,correct:a,total:s,percentage:i,pointsEarned:f}),r("finished");return}O(s=>s+1),z(null),E(!1),k(!1),S(!1)},[g,m,j,d,v]),P=l.useCallback(()=>{r("home")},[]);if(n==="home")return e.jsxs("div",{className:"min-h-screen pb-24 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-6 pb-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"w-10 h-10 rounded-full glass flex items-center justify-center text-gray-400 hover:text-white active:scale-90 transition-all",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Исламская викторина"}),e.jsx("p",{className:"text-emerald-400/70 text-sm",children:"Проверь свои знания"})]})]}),e.jsxs("div",{className:"px-4 mt-5",children:[e.jsx("h3",{className:"text-xs font-semibold text-white/40 uppercase tracking-widest mb-3",children:"Категории"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:N.map(t=>{const s=we(t.color),a=ae[t.key]||0,i=t.key,c=o[i];return e.jsxs("button",{onClick:()=>q(t.key),className:`relative glass-card p-4 text-left border-l-4 ${s.border} active:scale-[0.97] transition-all duration-200 hover:shadow-lg ${s.glow}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${s.bg} flex items-center justify-center text-2xl mb-3`,children:t.icon}),e.jsx("h3",{className:"text-white font-semibold text-sm mb-1",children:t.name}),e.jsx("p",{className:"text-gray-500 text-xs leading-relaxed mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600 text-xs",children:[a," ",a===1?"вопрос":a<5?"вопроса":"вопросов"]}),c&&e.jsxs("span",{className:`text-xs font-medium ${c.percentage>=70?"text-emerald-400":c.percentage>=40?"text-amber-400":"text-red-400"}`,children:[e.jsx(U,{className:"w-3 h-3 inline mr-0.5"}),c.percentage,"%"]})]})]},t.key)})}),e.jsxs("button",{onClick:()=>q(null),className:"w-full mt-4 py-4 rounded-2xl bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-semibold text-lg flex items-center justify-center gap-3 active:scale-[0.97] transition-all shadow-lg shadow-emerald-500/20 hover:shadow-emerald-500/40",children:[e.jsx(he,{className:"w-5 h-5"}),"Все вопросы (",C.length,")"]}),o._all&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3 text-sm",children:[e.jsx(U,{className:"w-4 h-4 text-amber-400"}),e.jsxs("span",{className:"text-gray-400",children:["Лучший результат:"," ",e.jsxs("span",{className:`font-medium ${o._all.percentage>=70?"text-emerald-400":o._all.percentage>=40?"text-amber-400":"text-red-400"}`,children:[o._all.percentage,"%"]})]})]}),(()=>{const t=Y();return t.length===0?null:e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xs font-semibold text-white/40 uppercase tracking-widest mb-3 px-1",children:"История прохождений"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.slice(0,10).map((s,a)=>{const i=s.category?N.find(f=>f.key===s.category)?.name||s.category:"Все вопросы",c=new Date(s.date),h=c.toLocaleDateString("ru-RU",{day:"numeric",month:"short"}),p=c.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"glass-card p-3 flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-sm font-bold ${s.percentage>=70?"bg-emerald-500/20 text-emerald-400":s.percentage>=40?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:[s.percentage,"%"]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white font-medium truncate",children:i}),e.jsxs("p",{className:"text-[10px] text-white/30",children:[s.correct,"/",s.total," правильных",s.pointsEarned>0&&e.jsxs("span",{className:"text-emerald-400 ml-1",children:["+",s.pointsEarned," баллов"]})]})]}),e.jsxs("span",{className:"text-[10px] text-white/20",children:[h," ",p]})]},a)})})]})})()]}),e.jsx("style",{children:$})]});if(n==="playing"){const t=m[g];if(!t)return r("finished"),null;const s=m.length,a=(g+1)/s*100,i=d?N.find(c=>c.key===d)?.name||"Викторина":"Все вопросы";return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-6 pb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-400 text-xs",children:i}),e.jsxs("p",{className:"text-white text-sm font-medium",children:["Вопрос ",g+1," из ",s]})]}),e.jsx("button",{onClick:P,className:"w-9 h-9 rounded-full glass flex items-center justify-center text-gray-400 hover:text-white active:scale-90 transition-all",children:e.jsx(R,{className:"w-5 h-5"})})]}),!v&&e.jsxs("div",{className:"flex items-center justify-center gap-1.5 px-4 mb-2",children:[e.jsx(_,{size:12,className:"text-slate-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Тренировка (без очков)"})]}),e.jsx("div",{className:"mx-4 mt-1 mb-6 h-2 rounded-full t-bg overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500",style:{width:`${a}%`}})}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("div",{className:`glass-card p-6 transition-all duration-300 ${se?"quiz-flash-correct":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-emerald-500/15 text-emerald-400 text-xs font-bold",children:g+1}),d===null&&t&&e.jsx("span",{className:"text-xs text-gray-500 t-bg px-2 py-0.5 rounded-full",children:N.find(c=>c.key===t.category)?.name})]}),e.jsx("h2",{className:"text-xl font-semibold text-white leading-relaxed",children:t?.question})]})}),e.jsx("div",{className:"px-4 space-y-3",children:t?.options.map((c,h)=>{let p="t-bg border t-border-s text-gray-200 active:scale-[0.98]",f=e.jsx("span",{className:"w-8 h-8 rounded-full t-bg flex items-center justify-center text-sm text-gray-400 shrink-0",children:String.fromCharCode(1040+h)});return b!==null&&(h===t.correctIndex?(p="bg-emerald-500/20 border border-emerald-500/50 text-emerald-300 quiz-flash-correct-btn",f=e.jsx("span",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center shrink-0",children:e.jsx(J,{className:"w-4 h-4 text-emerald-400"})})):h===b?(p=`bg-red-500/20 border border-red-500/50 text-red-300 ${te?"quiz-shake":""}`,f=e.jsx("span",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center shrink-0",children:e.jsx(R,{className:"w-4 h-4 text-red-400"})})):p="t-bg border t-border text-gray-500 opacity-40"),e.jsx("button",{onClick:()=>re(h),disabled:b!==null,className:`w-full py-4 px-4 rounded-xl font-medium transition-all duration-300 ${p}`,children:e.jsxs("span",{className:"flex items-center gap-3",children:[f,e.jsx("span",{className:"text-left",children:c})]})},h)})}),V&&t?.explanation&&e.jsx("div",{className:"px-4 mt-4 animate-fade-in",children:e.jsxs("div",{className:"glass-card p-4 border border-emerald-500/10",children:[e.jsx("p",{className:"text-emerald-400/80 text-xs font-medium uppercase tracking-wider mb-1",children:"Пояснение"}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:t.explanation})]})}),b!==null&&e.jsx("div",{className:"px-4 mt-6 animate-fade-in",children:e.jsx("button",{onClick:le,className:"w-full py-4 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-semibold text-lg active:scale-[0.97] transition-all shadow-lg shadow-emerald-500/20",children:g+1>=m.length?"Показать результаты":"Далее"})}),e.jsx("style",{children:$})]})}const w=m.length,u=w>0?Math.round(j/w*100):0,ne=w-j,ce=d?N.find(t=>t.key===d)?.name||"Викторина":"Все вопросы",L=l.useMemo(()=>{if(d!==null)return null;const t={};m.forEach(a=>{t[a.category]||(t[a.category]={correct:0,total:0}),t[a.category].total++});const s=new Set(y.map(a=>a.question.id));return m.forEach(a=>{!s.has(a.id)&&t[a.category]&&t[a.category].correct++}),t},[d,m,y]),ie=u>=70?"text-emerald-400":u>=40?"text-amber-400":"text-red-400",oe=u>=70?"stroke-emerald-500":u>=40?"stroke-amber-500":"stroke-red-500",de=u>=70?"bg-emerald-500/10 glow-green":u>=40?"bg-amber-500/10 glow-gold":"bg-red-500/10",xe=()=>u>=90?"Машаллах! Ты настоящий учёный!":u>=70?"Отличный результат! Продолжай учиться":u>=50?"Хорошая попытка! Есть над чем поработать":"Не сдавайся! Учись и пробуй снова",I=54,A=2*Math.PI*I,me=A-u/100*A;return e.jsxs("div",{className:"min-h-screen pb-24 animate-fade-in",children:[e.jsxs("div",{className:"px-4 pt-6 pb-4 text-center",children:[e.jsx("h2",{className:"text-gray-400 text-sm",children:ce}),e.jsx("h1",{className:"text-xl font-bold text-white mt-1",children:"Результаты"})]}),e.jsxs("div",{className:"flex flex-col items-center px-4 mt-2",children:[e.jsxs("div",{className:`relative w-36 h-36 rounded-full ${de} flex items-center justify-center`,children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",viewBox:"0 0 120 120",children:[e.jsx("circle",{cx:"60",cy:"60",r:I,fill:"none",stroke:"rgba(255,255,255,0.05)",strokeWidth:"8"}),e.jsx("circle",{cx:"60",cy:"60",r:I,fill:"none",className:oe,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:A,strokeDashoffset:me,style:{transition:"stroke-dashoffset 1s ease-out"}})]}),e.jsxs("div",{className:"text-center z-10",children:[e.jsxs("span",{className:`text-4xl font-bold ${ie}`,children:[u,"%"]}),e.jsxs("p",{className:"text-gray-500 text-xs mt-0.5",children:[j,"/",w]})]})]}),e.jsx("p",{className:"text-white font-semibold text-lg mt-6 text-center",children:xe()}),e.jsxs("div",{className:"flex items-center gap-6 mt-5",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:j}),e.jsx("div",{className:"text-xs text-gray-500",children:"Верных"})]}),e.jsx("div",{className:"w-px h-10 t-bg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:ne}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ошибок"})]}),e.jsx("div",{className:"w-px h-10 t-bg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:w}),e.jsx("div",{className:"text-xs text-gray-500",children:"Всего"})]})]}),D>0?e.jsxs("div",{className:"mt-5 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-emerald-500/15 border border-emerald-500/30",children:[e.jsx(ge,{className:"w-5 h-5 text-emerald-400"}),e.jsxs("span",{className:"text-emerald-400 font-semibold text-sm",children:["+",D," очков начислено!"]})]}):v?null:e.jsxs("div",{className:"mt-5 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-slate-500/15 border border-slate-500/30",children:[e.jsx(_,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-slate-400 text-sm",children:"Тренировка — очки уже получены"})]})]}),L&&e.jsxs("div",{className:"px-4 mt-6",children:[e.jsx("h3",{className:"text-gray-400 text-sm font-medium mb-3",children:"По категориям"}),e.jsx("div",{className:"space-y-2",children:N.map(t=>{const s=L[t.key];if(!s)return null;const a=Math.round(s.correct/s.total*100);return e.jsxs("div",{className:"glass-card p-3 flex items-center gap-3",children:[e.jsx("span",{className:"text-lg",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-white text-sm font-medium truncate",children:t.name}),e.jsxs("span",{className:`text-xs font-medium ${a>=70?"text-emerald-400":a>=40?"text-amber-400":"text-red-400"}`,children:[s.correct,"/",s.total]})]}),e.jsx("div",{className:"h-1.5 rounded-full t-bg overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-700 ${a>=70?"bg-emerald-500":a>=40?"bg-amber-500":"bg-red-500"}`,style:{width:`${a}%`}})})]})]},t.key)})})]}),y.length>0&&e.jsx(ye,{wrongAnswers:y}),e.jsxs("div",{className:"px-4 mt-6 space-y-3",children:[e.jsxs("button",{onClick:()=>q(d),className:"w-full py-4 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-semibold text-lg flex items-center justify-center gap-2 active:scale-[0.97] transition-all shadow-lg shadow-emerald-500/20",children:[e.jsx(_,{className:"w-5 h-5"}),"Попробовать снова"]}),e.jsxs("button",{onClick:P,className:"w-full py-4 rounded-xl glass text-gray-300 font-medium text-base flex items-center justify-center gap-2 active:scale-[0.97] transition-all",children:[e.jsx(W,{className:"w-5 h-5"}),"Назад к категориям"]})]}),e.jsx("style",{children:$})]})}function ye({wrongAnswers:n}){const[r,o]=l.useState(!1);return e.jsxs("div",{className:"px-4 mt-6",children:[e.jsxs("button",{onClick:()=>o(!r),className:"w-full flex items-center justify-between py-3 text-left",children:[e.jsxs("h3",{className:"text-gray-400 text-sm font-medium",children:["Ошибки (",n.length,")"]}),r?e.jsx(pe,{className:"w-4 h-4 text-gray-500"}):e.jsx(fe,{className:"w-4 h-4 text-gray-500"})]}),r&&e.jsx("div",{className:"space-y-3 animate-fade-in",children:n.map((x,d)=>e.jsxs("div",{className:"glass-card p-4 border border-red-500/10",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("p",{className:"text-white text-sm font-medium flex-1",children:x.question.question})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(R,{className:"w-3.5 h-3.5 text-red-400 shrink-0"}),e.jsx("span",{className:"text-red-400 text-xs",children:x.question.options[x.selectedIndex]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"w-3.5 h-3.5 text-emerald-400 shrink-0"}),e.jsx("span",{className:"text-emerald-400 text-xs",children:x.question.options[x.question.correctIndex]})]}),x.question.explanation&&e.jsx("p",{className:"text-gray-500 text-xs leading-relaxed mt-2 pt-2 border-t t-border",children:x.question.explanation})]},d))})]})}const $=`
  @keyframes quiz-shake {
    0%, 100% { transform: translateX(0); }
    10%, 50%, 90% { transform: translateX(-6px); }
    30%, 70% { transform: translateX(6px); }
  }
  .quiz-shake {
    animation: quiz-shake 0.5s ease-in-out;
  }
  @keyframes quiz-flash-green {
    0% { box-shadow: 0 0 0 rgba(16, 185, 129, 0); }
    50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.4), inset 0 0 20px rgba(16, 185, 129, 0.1); }
    100% { box-shadow: 0 0 0 rgba(16, 185, 129, 0); }
  }
  .quiz-flash-correct {
    animation: quiz-flash-green 0.6s ease-out;
  }
  .quiz-flash-correct-btn {
    animation: quiz-flash-green 0.6s ease-out;
  }
`;export{Ie as default};
