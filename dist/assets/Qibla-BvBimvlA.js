import{c as O,s as G,j as e,C as F,z as M,A as C,D as L}from"./index-Cln3HTWx.js";import{b as o}from"./vendor-CpRrxz-h.js";const A=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],D=O("navigation",A),W=21.4225,B=39.8262,q=[{name:"Бишкек",lat:42.8746,lng:74.5698},{name:"Москва",lat:55.7558,lng:37.6173},{name:"Стамбул",lat:41.0082,lng:28.9784},{name:"Алматы",lat:43.222,lng:76.8512},{name:"Ташкент",lat:41.2995,lng:69.2401}];function I(n,j,r,t){const l=v=>v*Math.PI/180,d=l(r-n),f=l(t-j),g=Math.sin(d/2)*Math.sin(d/2)+Math.cos(l(n))*Math.cos(l(r))*Math.sin(f/2)*Math.sin(f/2);return 6371*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))}function z(n){return n<1?`${Math.round(n*1e3)} м`:n<100?`${n.toFixed(1)} км`:`${Math.round(n).toLocaleString("ru-RU")} км`}function H({qiblaDeg:n,heading:j,size:r=300}){const t=r/2,a=r/2-8,l=a-30,d=a-4,f=a-18,g=j!==null?-j:0,b=n,v=[{label:"С",angle:0,color:"#ef4444"},{label:"В",angle:90,color:"#ffffff99"},{label:"Ю",angle:180,color:"#ffffff99"},{label:"З",angle:270,color:"#ffffff99"}],w=[];for(let i=0;i<360;i+=5)w.push({angle:i,major:i%30===0});return e.jsxs("div",{className:"relative",style:{width:r,height:r},children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"radial-gradient(circle, rgba(16,185,129,0.08) 0%, transparent 70%)",filter:"blur(20px)"}}),e.jsxs("svg",{width:r,height:r,viewBox:`0 0 ${r} ${r}`,className:"drop-shadow-2xl",children:[e.jsxs("defs",{children:[e.jsxs("radialGradient",{id:"compassFace",cx:"50%",cy:"40%",r:"60%",children:[e.jsx("stop",{offset:"0%",stopColor:"#1e293b"}),e.jsx("stop",{offset:"100%",stopColor:"#0f172a"})]}),e.jsxs("linearGradient",{id:"qiblaGold",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fbbf24"}),e.jsx("stop",{offset:"50%",stopColor:"#f59e0b"}),e.jsx("stop",{offset:"100%",stopColor:"#d97706"})]}),e.jsxs("radialGradient",{id:"emeraldGlow",cx:"50%",cy:"50%",r:"50%",children:[e.jsx("stop",{offset:"0%",stopColor:"rgba(16,185,129,0.3)"}),e.jsx("stop",{offset:"100%",stopColor:"rgba(16,185,129,0)"})]}),e.jsxs("filter",{id:"qiblaGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),e.jsx("feFlood",{floodColor:"#f59e0b",floodOpacity:"0.6",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"shadow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"shadow"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"northGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),e.jsx("feFlood",{floodColor:"#ef4444",floodOpacity:"0.5",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"shadow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"shadow"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsxs("g",{transform:`rotate(${g} ${t} ${t})`,style:{transition:j!==null?"transform 0.3s ease-out":"none"},children:[e.jsx("circle",{cx:t,cy:t,r:a,fill:"none",stroke:"rgba(255,255,255,0.12)",strokeWidth:"2"}),e.jsx("circle",{cx:t,cy:t,r:a-1,fill:"url(#compassFace)"}),e.jsx("circle",{cx:t,cy:t,r:l,fill:"none",stroke:"rgba(255,255,255,0.06)",strokeWidth:"1",strokeDasharray:"4 4"}),w.map(({angle:i,major:m})=>{const x=i*Math.PI/180,h=m?d-12:d-6,N=t+h*Math.sin(x),u=t-h*Math.cos(x),y=t+d*Math.sin(x),k=t-d*Math.cos(x);return e.jsx("line",{x1:N,y1:u,x2:y,y2:k,stroke:m?"rgba(255,255,255,0.4)":"rgba(255,255,255,0.15)",strokeWidth:m?2:1,strokeLinecap:"round"},i)}),v.map(({label:i,angle:m,color:x})=>{const h=m*Math.PI/180,N=t+f*Math.sin(h),u=t-f*Math.cos(h);return e.jsx("text",{x:N,y:u,textAnchor:"middle",dominantBaseline:"central",fill:x,fontSize:"16",fontWeight:"bold",fontFamily:"system-ui, sans-serif",filter:m===0?"url(#northGlow)":void 0,children:i},i)}),e.jsx("polygon",{points:`${t},${t-a+2} ${t-6},${t-a+14} ${t+6},${t-a+14}`,fill:"#ef4444",filter:"url(#northGlow)"}),e.jsxs("g",{transform:`rotate(${b} ${t} ${t})`,filter:"url(#qiblaGlow)",children:[e.jsx("line",{x1:t,y1:t,x2:t,y2:t-l+10,stroke:"url(#qiblaGold)",strokeWidth:"3",strokeLinecap:"round",opacity:"0.9"}),e.jsx("polygon",{points:`${t},${t-l+2} ${t-8},${t-l+18} ${t+8},${t-l+18}`,fill:"url(#qiblaGold)"}),e.jsx("rect",{x:t-7,y:t-l-8,width:"14",height:"14",rx:"2",fill:"#f59e0b",stroke:"#fbbf24",strokeWidth:"1"}),e.jsx("text",{x:t,y:t-l-.5,textAnchor:"middle",dominantBaseline:"central",fill:"#1e293b",fontSize:"9",fontWeight:"bold",children:"Ka"})]}),e.jsx("circle",{cx:t,cy:t,r:"6",fill:"#10b981",opacity:"0.8"}),e.jsx("circle",{cx:t,cy:t,r:"3",fill:"#fff",opacity:"0.9"})]}),e.jsx("circle",{cx:t,cy:t,r:a+4,fill:"none",stroke:"rgba(16,185,129,0.15)",strokeWidth:"1"}),e.jsx("polygon",{points:`${t},4 ${t-8},20 ${t+8},20`,fill:"#10b981",opacity:"0.8"})]})]})}function Q(){const[n,j]=o.useState(null),[r,t]=o.useState(null),[a,l]=o.useState(null),[d,f]=o.useState(""),[g,b]=o.useState(!0),[v,w]=o.useState(null),[i,m]=o.useState(!1),[x,h]=o.useState(!1),[N,u]=o.useState(!1);o.useEffect(()=>{const s=G.getProfile();if(s.lat&&s.lng){l({lat:s.lat,lng:s.lng}),f(s.city||"");return}"geolocation"in navigator?navigator.geolocation.getCurrentPosition(p=>{l({lat:p.coords.latitude,lng:p.coords.longitude})},()=>{u(!0),b(!1)},{enableHighAccuracy:!0,timeout:1e4}):(u(!0),b(!1))},[]),o.useEffect(()=>{if(!a)return;let s=!1;async function p(){b(!0),w(null);try{const c=await L(a.lat,a.lng);if(s)return;j(c.direction)}catch(c){console.error("Failed to load Qibla direction:",c),s||w("Не удалось загрузить направление Киблы")}finally{s||b(!1)}}return p(),()=>{s=!0}},[a]),o.useEffect(()=>{function s(c){const $=c.webkitCompassHeading;if($!=null)t($),m(!0);else if(c.alpha!==null&&c.alpha!==void 0){const R=c.absolute?(360-c.alpha)%360:c.alpha;t(R),m(!0)}}const p=window.DeviceOrientationEvent;return p&&typeof p.requestPermission=="function"?x&&p.requestPermission().then(c=>{c==="granted"&&window.addEventListener("deviceorientation",s,!0)}).catch(()=>{}):"DeviceOrientationEvent"in window&&window.addEventListener("deviceorientation",s,!0),()=>{window.removeEventListener("deviceorientation",s,!0)}},[x]),o.useEffect(()=>{const s=window.DeviceOrientationEvent;(!s||typeof s.requestPermission!="function")&&h(!0)},[]);function y(s){l({lat:s.lat,lng:s.lng}),f(s.name),u(!1),G.setProfile({lat:s.lat,lng:s.lng,city:s.name})}const k=a?I(a.lat,a.lng,W,B):null,S=n!==null?n:0,E=typeof window<"u"?window.DeviceOrientationEvent:null,P=E&&typeof E.requestPermission=="function";return e.jsxs("div",{className:"min-h-screen pb-24 px-4 pt-4 max-w-lg mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 animate-fade-in",children:[e.jsx("button",{onClick:()=>window.history.back(),className:`w-10 h-10 rounded-full glass flex items-center justify-center
                     text-white/70 hover:text-white transition-colors active:scale-95`,children:e.jsx(F,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Кибла"}),e.jsx("p",{className:"text-xs text-white/40",children:"Направление к Каабе"})]}),e.jsx("div",{className:"w-10 h-10 rounded-full glass flex items-center justify-center text-emerald-400",children:e.jsx(M,{className:"w-5 h-5"})})]}),N&&!a&&e.jsxs("div",{className:"glass-card p-5 mb-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-400/70 text-xs font-medium uppercase tracking-widest mb-4",children:[e.jsx(C,{size:14}),e.jsx("span",{children:"Выберите город"})]}),e.jsx("p",{className:"text-sm t-text-m mb-4",children:"Не удалось определить местоположение. Выберите ближайший город:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:q.map(s=>e.jsxs("button",{onClick:()=>y(s),className:`glass p-3 rounded-xl text-sm t-text font-medium
                           hover:bg-emerald-500/10 hover:border-emerald-500/30 hover:text-emerald-300
                           border t-border-s transition-all duration-200 active:scale-95`,children:[e.jsx(C,{size:14,className:"inline mr-1.5 text-emerald-400/60"}),s.name]},s.name))})]}),g&&a&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 animate-fade-in",children:[e.jsx("div",{className:"w-10 h-10 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-white/40 text-sm",children:"Определяю направление Киблы..."})]}),v&&e.jsx("div",{className:"glass-card p-4 mb-6 border-red-500/30 animate-fade-in",children:e.jsx("p",{className:"text-red-400 text-sm text-center",children:v})}),!g&&n!==null&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center mb-6 animate-fade-in",children:[e.jsxs("div",{className:"glass-card px-5 py-2 mb-5 flex items-center gap-2",children:[e.jsx(D,{size:16,className:"text-amber-400",style:{transform:`rotate(${S}deg)`}}),e.jsxs("span",{className:"text-xl font-mono font-bold text-white tabular-nums",children:[n.toFixed(1),"°"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"radial-gradient(circle, rgba(16,185,129,0.12) 0%, rgba(245,158,11,0.06) 40%, transparent 70%)",filter:"blur(30px)",transform:"scale(1.3)"}}),e.jsx(H,{qiblaDeg:S,heading:r,size:280})]}),i?e.jsxs("p",{className:"text-xs text-emerald-400/60 mt-4 flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"}),"Компас активен"]}):e.jsx("p",{className:"text-xs t-text-f mt-4",children:"Поверните устройство для калибровки"})]}),e.jsxs("div",{className:"glass-card p-5 mb-4 animate-fade-in relative overflow-hidden",children:[e.jsx("div",{className:"absolute -top-8 -right-8 w-32 h-32 bg-amber-500/8 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"flex items-center gap-2 text-amber-400/70 text-xs font-medium uppercase tracking-widest mb-4",children:[e.jsx(D,{size:14}),e.jsx("span",{children:"Направление Киблы"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm t-text-m",children:"Направление"}),e.jsxs("span",{className:"text-sm font-mono font-semibold text-white",children:[n.toFixed(1),"°"]})]}),k!==null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm t-text-m",children:"Расстояние до Каабы"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-400",children:z(k)})]}),d&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm t-text-m",children:"Город"}),e.jsxs("span",{className:"text-sm font-semibold t-text flex items-center gap-1.5",children:[e.jsx(C,{size:12,className:"text-emerald-400/60"}),d]})]}),a&&e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t t-border",children:[e.jsx("span",{className:"text-xs t-text-f",children:"Координаты"}),e.jsxs("span",{className:"text-xs font-mono t-text-f",children:[a.lat.toFixed(4),", ",a.lng.toFixed(4)]})]})]})]}),P&&!i&&!x&&e.jsxs("div",{className:"glass-card p-5 mb-4 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-400/70 text-xs font-medium uppercase tracking-widest mb-3",children:[e.jsx(M,{size:14}),e.jsx("span",{children:"Компас устройства"})]}),e.jsx("p",{className:"text-sm t-text-m mb-4",children:"Разрешите доступ к компасу устройства, чтобы стрелка Киблы автоматически указывала правильное направление при повороте телефона."}),e.jsx("button",{onClick:()=>h(!0),className:`w-full py-3 rounded-xl text-sm font-semibold
                           bg-emerald-500/20 border border-emerald-500/40 text-emerald-300
                           hover:bg-emerald-500/30 transition-all duration-200 active:scale-95`,children:"Включить компас"})]}),!i&&x&&e.jsxs("div",{className:"glass-card p-5 mb-4 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2 t-text-m text-xs font-medium uppercase tracking-widest mb-3",children:[e.jsx(M,{size:14}),e.jsx("span",{children:"Ручной режим"})]}),e.jsx("p",{className:"text-sm text-white/40 leading-relaxed",children:"Компас устройства недоступен. Чтобы найти Киблу вручную:"}),e.jsxs("ol",{className:"text-sm t-text-m mt-3 space-y-2 list-decimal list-inside",children:[e.jsx("li",{children:"Определите север (используйте физический компас или приложение)"}),e.jsxs("li",{children:["Повернитесь на"," ",e.jsxs("span",{className:"text-amber-400 font-semibold font-mono",children:[n.toFixed(1),"°"]})," ","по часовой стрелке от севера"]}),e.jsx("li",{children:"Это и будет направление Киблы"})]})]}),e.jsxs("button",{onClick:()=>u(s=>!s),className:`glass-card p-3 w-full text-center text-sm text-white/40
                       hover:t-text-s transition-colors animate-fade-in`,children:[e.jsx(C,{size:14,className:"inline mr-1.5"}),"Изменить местоположение"]}),N&&a&&e.jsxs("div",{className:"glass-card p-4 mt-3 animate-fade-in",children:[e.jsx("p",{className:"text-xs text-white/40 uppercase tracking-widest mb-3",children:"Выберите город"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:q.map(s=>e.jsx("button",{onClick:()=>y(s),className:`glass p-2.5 rounded-xl text-sm font-medium
                      border transition-all duration-200 active:scale-95
                      ${d===s.name?"bg-emerald-500/15 border-emerald-500/40 text-emerald-300":"t-border-s t-text-s hover:t-bg hover:t-text"}`,children:s.name},s.name))})]})]})]})}export{Q as default};
