# üöÄ IMAN App ‚Äî Deploy Checklist

## ‚úÖ –ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π Volume –Ω–∞ Railway

### 1. –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å Volume

- ‚úÖ **server.js** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/data` –¥–ª—è Railway
  ```javascript
  const DATA_DIR = process.env.RAILWAY_ENVIRONMENT ? "/data" : join(__dirname, "data");
  ```

- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `/data/iman.db`
- ‚úÖ **–ü–æ–¥–ø–∏—Å—á–∏–∫–∏** —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/data/subscribers.json`
- ‚úÖ **–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏** `check-volume.js` –¥–æ–±–∞–≤–ª–µ–Ω

### 2. –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Volume
npm run check:volume
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üìç ENVIRONMENT:
   Railway: ‚ùå NO (local)
   Data Directory: /Users/.../iman-app/data

üíæ DATABASE:
   ‚úÖ Exists: iman.db
   üìä Size: X.XX MB
```

---

## üöÇ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Railway Volume

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://railway.app/dashboard
2. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **iman-app**
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ Volume

1. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–∏—Å (–≤ —Å–ø–∏—Å–∫–µ —Å–ª–µ–≤–∞)
2. –í–∫–ª–∞–¥–∫–∞ **Settings** ‚öôÔ∏è
3. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–æ —Å–µ–∫—Ü–∏–∏ **Volumes**
4. –ù–∞–∂–º–∏—Ç–µ **+ New Volume**

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **Name:** `iman-data`
- **Mount Path:** `/data` ‚ö†Ô∏è (–Ω–µ `/app/data`!)
- **Size:** `1` GB

5. –ù–∞–∂–º–∏—Ç–µ **Create Volume**

### –®–∞–≥ 3: Redeploy –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –í–∫–ª–∞–¥–∫–∞ **Deployments**
2. –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π ‚Üí –∫–Ω–æ–ø–∫–∞ **‚ãÆ** (—Ç—Ä–∏ —Ç–æ—á–∫–∏)
3. **Redeploy**
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Railway Shell (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –í Railway Dashboard ‚Üí –≤–∞—à —Å–µ—Ä–≤–∏—Å
2. –í–∫–ª–∞–¥–∫–∞ **Shell** (–∏–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –≤ –º–µ–Ω—é)
3. –ù–∞–∂–º–∏—Ç–µ **Open Shell**
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
npm run check:volume
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üìç ENVIRONMENT:
   Railway: ‚úÖ YES
   Data Directory: /data

üìÅ DATA DIRECTORY:
   ‚úÖ Exists: /data
   ‚úÖ Readable: YES
   ‚úÖ Writable: YES

üöÇ RAILWAY VOLUME:
   ‚úÖ Using correct path: /data
   ‚úÖ /data is mounted
   ‚úÖ Volume is WORKING
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (End-to-End —Ç–µ—Å—Ç)

1. –û—Ç–∫—Ä–æ–π—Ç–µ IMAN App –≤ Telegram
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ
3. –û—Ç–º–µ—Ç—å—Ç–µ –ª—é–±–æ–π –Ω–∞–º–∞–∑
4. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí —É–≤–∏–¥–∏—Ç–µ —Å–µ–±—è –≤ —Å–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
5. **–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Railway** ‚Üí Deployments ‚Üí Redeploy
6. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã
7. **–°–Ω–æ–≤–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å ‚Üí Volume —Ä–∞–±–æ—Ç–∞–µ—Ç!
- ‚ùå –î–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–ª–∏ ‚Üí Volume –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Å–º. Troubleshooting)

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–ø–∞–¥–∞—é—Ç –ø–æ—Å–ª–µ redeploy

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

#### 1. Mount Path –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `/data`
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `/app/data`, `data`, `/var/data`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í Railway Shell –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
echo $DATA_DIR
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: /data
```

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
1. Settings ‚Üí Volumes ‚Üí —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π Volume
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º Mount Path: `/data`
3. Redeploy

#### 2. Volume –Ω–µ —Å–æ–∑–¥–∞–Ω –∏–ª–∏ –Ω–µ –≤ —Å—Ç–∞—Ç—É—Å–µ Active

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Settings ‚Üí Volumes ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `iman-data` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º Active

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ Volume –∑–∞–Ω–æ–≤–æ
- –ï—Å–ª–∏ –µ—Å—Ç—å, –Ω–æ —Å—Ç–∞—Ç—É—Å "Pending" ‚Äî –ø–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã

#### 3. –ö–æ–¥ –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ Railway

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ
grep "RAILWAY_ENVIRONMENT" server.js
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
# const DATA_DIR = process.env.RAILWAY_ENVIRONMENT ? "/data" : ...
```

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
- –°–¥–µ–ª–∞–π—Ç–µ git push
- Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç

#### 4. –ù–µ —Å–¥–µ–ª–∞–Ω redeploy –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Volume

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- Deployments ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π ‚Üí ‚ãÆ ‚Üí Redeploy

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Volume

1. Settings ‚Üí Volumes ‚Üí iman-data
2. –°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–µ **Usage**

**–ù–æ—Ä–º–∞:**
- –î–æ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: < 10 MB
- –î–æ 10000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: < 100 MB
- –î–æ 50000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: < 500 MB

**–ï—Å–ª–∏ –±–ª–∏–∑–∫–æ –∫ –ª–∏–º–∏—Ç—É:**
- –£–≤–µ–ª–∏—á—å—Ç–µ Size (Settings ‚Üí Volumes ‚Üí Edit ‚Üí Size: 2 GB)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Shell

```bash
# –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
du -h /data/iman.db

# –í—Å–µ —Ñ–∞–π–ª—ã –≤ /data
ls -lh /data/

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)
wc -c /data/iman.db | awk '{printf "%.2f MB\n", $1/1024/1024}'
```

---

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

–û—Ç–º–µ—Ç—å—Ç–µ –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç:

- [ ] 1. –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω (server.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/data` –¥–ª—è Railway)
- [ ] 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è git deploy)
- [ ] 3. –û—Ç–∫—Ä—ã–ª Railway Dashboard
- [ ] 4. –°–æ–∑–¥–∞–ª Volume: Name=`iman-data`, Path=`/data`, Size=`1 GB`
- [ ] 5. Volume –≤ —Å—Ç–∞—Ç—É—Å–µ Active
- [ ] 6. –°–¥–µ–ª–∞–ª Redeploy
- [ ] 7. –ü—Ä–æ–≤–µ—Ä–∏–ª —á–µ—Ä–µ–∑ `npm run check:volume` –≤ Railway Shell
- [ ] 8. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ redeploy

**–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã ‚Äî Volume –Ω–∞—Å—Ç—Ä–æ–µ–Ω! üéâ**

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `RAILWAY_VOLUME_QUICK_SETUP.md`
- **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `RAILWAY_VOLUME_SETUP.md`
- **Railway Docs:** https://docs.railway.app/reference/volumes
- **–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:** `check-volume.js`

---

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –£–¥–∞–ª–∏—Ç–µ Volume (Settings ‚Üí Volumes ‚Üí Delete)
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–Ω–æ–≤–æ —Å —Ç–æ—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–¥–µ–ª–∞–π—Ç–µ Redeploy
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ Railway Shell: `npm run check:volume`

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:**
- Railway Discord: https://discord.gg/railway
- –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue —Å –≤—ã–≤–æ–¥–æ–º `npm run check:volume`
