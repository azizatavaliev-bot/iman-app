# 🚂 Railway PostgreSQL - Простая Инструкция

## Почему встроенная БД Railway?

✅ **Бесплатно** — PostgreSQL плагин включён в Railway  
✅ **Автоматически** — Railway управляет БД за вас  
✅ **Надёжно** — данные сохраняются между деплоями  
✅ **Просто** — никаких внешних сервисов  

---

## 📋 Настройка (5 минут)

### Шаг 1: Добавьте PostgreSQL в Railway

1. Откройте Railway Dashboard
2. Ваш проект **IMAN APP**
3. Нажмите **"+ New"** (кнопка справа вверху)
4. Выберите **"Database"** → **"Add PostgreSQL"**
5. Подождите 30 секунд — БД создаётся автоматически

✅ PostgreSQL добавлен!

---

### Шаг 2: Подключите БД к сервису

1. В списке сервисов теперь есть **postgres** (новый)
2. Кликните на ваш основной сервис **iman-app**
3. Перейдите на вкладку **Variables**
4. Найдите переменную **DATABASE_URL**
5. Она уже там! Railway автоматически добавил её 🎉

**Проверка:**
- Variables → должна быть `DATABASE_URL`
- Значение начинается с `postgresql://`

✅ Подключение настроено!

---

### Шаг 3: Я обновлю код

После того как вы выполните Шаги 1-2, **скажите мне**, и я:

1. Обновлю `server.js` для PostgreSQL
2. Заменю `better-sqlite3` на `pg`
3. Создам схему БД автоматически при запуске
4. Задеплою

**Railway автоматически перезапустит приложение с новой БД!**

---

## 🎯 Что будет храниться в БД?

### Таблица `users`:
- `telegram_id` — ID пользователя Telegram
- `data` — все данные пользователя (баллы, уровень, стрики, привычки)
- `updated_at` — когда обновлялись данные

### Таблица `analytics`:
- `id` — ID события
- `telegram_id` — кто сделал действие
- `type` — тип события (page_view, prayer_marked, habit_done)
- `page` — какая страница
- `action` — какое действие
- `timestamp` — когда произошло

---

## 📊 Админ-панель — что будет показывать:

### Блок 1: Общая статистика (4 карточки)
```
┌─────────────────┬─────────────────┬─────────────────┬─────────────────┐
│ Всего           │ Онлайн сейчас   │ Активных сегодня│ Активных за    │
│ пользователей   │                 │                 │ неделю         │
│     1,234       │       45        │      156        │      789       │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
```

### Блок 2: Средние показатели (3 карточки)
```
┌─────────────────┬─────────────────┬─────────────────┐
│ Средний уровень │ Средние баллы   │ Средний стрик  │
│   Му'мин        │     1,850       │      12 дней   │
└─────────────────┴─────────────────┴─────────────────┘
```

### Блок 3: Таблица пользователей
```
┌─────────┬──────────────┬────────┬────────┬────────┬──────────────────┐
│ Telegram│ Имя          │ Уровень│ Баллы  │ Стрик  │ Последняя        │
│ ID      │              │        │        │        │ активность       │
├─────────┼──────────────┼────────┼────────┼────────┼──────────────────┤
│ 123456  │ Акылай Н.    │ Хафиз  │ 25,300 │ 45 дн  │ 2 минуты назад   │
│ 789012  │ Азиз А.      │ Муслим │    450 │  3 дн  │ 1 час назад      │
│ 345678  │ Владимир В.  │ Талиб  │     80 │  1 дн  │ вчера            │
└─────────┴──────────────┴────────┴────────┴────────┴──────────────────┘
```

### Блок 4: Популярные страницы
```
📊 Топ-5 страниц:
1. Dashboard — 1,234 просмотров
2. Намазы — 856 просмотров
3. Викторина — 456 просмотров
4. Хадисы — 234 просмотров
5. Коран — 189 просмотров
```

### Блок 5: Популярные действия
```
⚡ Топ-5 действий:
1. prayer_marked — 2,345 раз
2. habit_completed — 1,234 раз
3. quiz_finished — 567 раз
4. page_viewed — 456 раз
5. bookmark_added — 123 раз
```

**Всё будет чётко, читабельно, блоки не будут накладываться!**

---

## ✅ Преимущества Railway PostgreSQL:

- ✅ Встроенная в Railway (не нужен внешний сервис)
- ✅ Бесплатная (до 512 MB данных)
- ✅ Автоматические бэкапы
- ✅ Данные не теряются при деплоях
- ✅ Простая настройка (2 клика)

---

## 🎬 Начните сейчас:

1. Railway Dashboard → ваш проект
2. **+ New** → **Database** → **Add PostgreSQL**
3. Скажите мне "Готово"
4. Я обновлю код

**Время: 5 минут!** 🚀
